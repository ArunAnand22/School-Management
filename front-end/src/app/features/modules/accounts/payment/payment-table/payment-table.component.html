<div class="payment-table-container">
  <div class="table-header">
    <h1>Payments List</h1>
    <div class="header-actions">
      <button class="btn-download" (click)="downloadCSV()" title="Download CSV">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15M17 8L12 3M12 3L7 8M12 3V15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Download CSV
      </button>
      <button class="btn-add" (click)="addNew()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        Add New Payment
      </button>
    </div>
  </div>

  <!-- Search Bar -->
  <div class="search-container">
    <div class="search-box">
      <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M21 21L15 15M17 10C17 13.866 13.866 17 10 17C6.13401 17 3 13.866 3 10C3 6.13401 6.13401 3 10 3C13.866 3 17 6.13401 17 10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <input
        type="text"
        class="search-input"
        placeholder="Search by reference, date, student, tutor, amount..."
        [(ngModel)]="searchQuery"
        (ngModelChange)="onSearch()"
      />
      <button *ngIf="searchQuery" class="clear-search" (click)="searchQuery = ''; onSearch()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
  </div>

  <div class="table-wrapper">
    <table class="payment-table">
      <thead>
        <tr>
          <th (click)="sort('date')" class="sortable">
            Date
            <span *ngIf="sortColumn === 'date'" class="sort-icon">
              {{ sortDirection === 'asc' ? '↑' : '↓' }}
            </span>
          </th>
          <th (click)="sort('referenceNumber')" class="sortable">
            Reference Number
            <span *ngIf="sortColumn === 'referenceNumber'" class="sort-icon">
              {{ sortDirection === 'asc' ? '↑' : '↓' }}
            </span>
          </th>
          <th>Transaction Type</th>
          <th (click)="sort('amount')" class="sortable">
            Amount
            <span *ngIf="sortColumn === 'amount'" class="sort-icon">
              {{ sortDirection === 'asc' ? '↑' : '↓' }}
            </span>
          </th>
          <th>Student</th>
          <th>Tutor</th>
          <th>Remarks</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let payment of paginatedPayments">
          <td>{{ payment.date }}</td>
          <td>{{ payment.referenceNumber }}</td>
          <td>
            <span class="badge badge-in">{{ payment.transactionType.toUpperCase() }}</span>
          </td>
          <td class="amount-cell">{{ formatCurrency(payment.amount) }}</td>
          <td>
            <span *ngIf="payment.studentName">
              {{ payment.studentRegNo }} - {{ payment.studentName }}
            </span>
            <span *ngIf="!payment.studentName" class="empty-cell">-</span>
          </td>
          <td>
            <span *ngIf="payment.tutorName">
              {{ payment.tutorRegNo }} - {{ payment.tutorName }}
            </span>
            <span *ngIf="!payment.tutorName" class="empty-cell">-</span>
          </td>
          <td>{{ payment.remarks || '-' }}</td>
          <td class="actions-cell">
            <button class="action-btn edit-btn" (click)="editPayment(payment)" title="Edit">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M17 3L21 7L13.7071 14.2929C13.3166 14.6834 12.6834 14.6834 12.2929 14.2929L10 12L17 3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M15 6L9 12L4 17L3 21L7 20L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <button class="action-btn delete-btn" (click)="deletePayment(payment)" title="Delete">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M10 11V17M14 11V17M4 7H20M19 7L18.38 19.2C18.2932 20.7546 18.2498 21.5323 17.8615 22.015C17.4732 22.4977 16.8068 22.4977 15.4735 22.4977H8.52646C7.19316 22.4977 6.52646 22.4977 6.13819 22.015C5.74992 21.5323 5.70672 20.7546 5.61992 19.2L5 7M10 7V4C10 3.44772 10.4477 3 11 3H13C13.5523 3 14 3.44772 14 4V7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="filteredPayments.length === 0" class="no-results">
    No payments found matching your criteria.
  </div>

  <div class="table-footer" *ngIf="filteredPayments.length > 0">
    <div class="pagination-info">
      Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to {{ Math.min(currentPage * itemsPerPage, filteredPayments.length) }} of {{ filteredPayments.length }} entries
    </div>
    <div class="pagination-controls">
      <button class="pagination-btn" (click)="goToPage(currentPage - 1)" [disabled]="currentPage === 1">Previous</button>
      <button
        *ngFor="let page of getPageNumbers()"
        class="pagination-btn"
        [class.active]="currentPage === page"
        (click)="goToPage(page)"
      >
        {{ page }}
      </button>
      <button class="pagination-btn" (click)="goToPage(currentPage + 1)" [disabled]="currentPage === totalPages">Next</button>
    </div>
  </div>
</div>

